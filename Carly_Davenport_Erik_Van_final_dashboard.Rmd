---
title: "Carly Davenport/Erik Van CEE218X Final Project "
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: fill
---

```{r global, include=FALSE}

library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(leaflet)
library(tidycensus)
library(StatMatch)

library(geojsonsf)
library(geojson)
library(plotly)
library(httr)

library(flexdashboard)
library(shiny)
```


```{r}
usa_zips <- zctas(cb = T, progress_bar = F)
oakland_data <- readRDS("oakland_data.rds")
alameda_data <- readRDS("alameda_data.rds")
```

Inputs {.sidebar}
-------------------------------------

```{r}
#checkboxGroupInput(
#  inputId = "target_income", 
#  label = "income:",
#  choices = c("Less than $10,000", "$10,000 to $14,999", "$15,000 to $19,999", "$20,000 #to $24,999", "$25,000 to $29,999", "$30,000 to $34,999", "$35,000 to $39,999", "$40,000 #to $44,999", "$45,000 to $49,999", "$50,000 to $59,999", "$60,000 to $74,999", "$75,000 #to $99,999", "$100,000 to $124,999", "$125,000 to $149,999", "$150,000 to $199,999", #"$200,000 or more"), 
#  selected = "Less than $10,000"
#)

selectInput(
  inputId = "target_race", 
  label = "race:",
  choices = c("Native Hawaiian and Other Pacific Islander Alone", "American Indian and Alaska Native Alone", "Black or African American", "Asian Alone", "White Alone", "Some Other Race Alone", "Two or More Races"), 
  selected = "Native Hawaiian and Other Pacific Islander Alone"
)

```

Column
-------------------------------------

### Plotting Race in Oakland

```{r}
leafletOutput("map")
```

```{r, context = "server"}
observeEvent({
  #input$target_income
  input$target_race
  },  {
     
     oakland_target_race_by_zip <- oakland_data %>% 
       select(Zip_Number, estimate, race) %>%
       group_by(Zip_Number, race) %>%
       mutate(Zip_Number = as.numeric(Zip_Number)) %>%
       summarize(estimate = sum(estimate)) %>%
      filter(race == target_race) %>%
        select(-race) 
      
     # oakland_target_race_by_zip_sf <- oakland_target_race_by_zip %>% 
     #   left_join(
     #     usa_zips %>% 
     #       transmute(GEOID10 = as.numeric(GEOID10)),
     #     by = c("Zip_Number" = "GEOID10")
     #     ) %>% 
     #   st_as_sf()
     # 
     # race_pal <- colorNumeric(
     #   palette = "Reds",
     #   domain = oakland_target_race_by_zip_sf$oakland_target_race_by_zip
     #   )
     # 
    # output$map <- renderLeaflet({ 
    #   leaflet() %>% 
    #   addProviderTiles(providers$CartoDB.Positron) %>% 
    #   addPolygons(
    #     data = oakland_target_race_by_zip_sf,
    #     fillColor = ~race_pal(oakland_target_race_by_zip$estimate),
    #     color = "white",
    #     weight = 0.5,
    #     fillOpacity = 0.5,
    #     label = ~oakland_target_race_by_zip$estimate
    #     ) %>%
    #   addLegend(
    #     data = oakland_target_race_by_zip_sf, 
    #     pal = race_pal,
    #     values = ~oakland_target_race_by_zip$estimate, 
    #     title = "Breakdown of population in Oakland"
    #     )
     #})
})
```

