type,
"UsageByZip.csv"
)
print(filename)
temp <- read_csv(filename)
if (type == "Electric") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Elec- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALKWH*3.41214,
AVERAGEKBTU = AVERAGEKWH*3.41214
) %>%
select(
-c(COMBINED, TOTALKWH, AVERAGEKWH)
)
}
if (type == "Gas") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Gas- Residential",
"Gas- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALTHM*99.9761,
AVERAGEKBTU = AVERAGETHM*99.9761
) %>%
select(
-c(COMBINED, TOTALTHM, AVERAGETHM)
)
}
if (year == 2018) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 12,
) %>%
select(
-c(MONTH)
)
}
if (year == 2019) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 24,
) %>%
select(
-c(MONTH)
)
}
if (year == 2020) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 36,
) %>%
select(
-c(MONTH)
)
}
if (year == 2021) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 48,
) %>%
select(
-c(MONTH)
)
}
pge_20 <- rbind(pge_20,temp_mutate_norm_month)
# Note rbind requires field names to be consistent for every new thing that you add.
saveRDS(pge_20, "pge_20.rds")
}
}
}
}
library(tidyverse)
years <- 2017:2021
quarters <- 1:4
types <- c("Electric", "Gas")
pge_20 <- NULL
for (type in types) {
for (year in years) {
for(quarter in quarters) {
if ((year != 2021) | (quarter != 3 & quarter != 4)) {
filename <-
paste0(
"pge/PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
temp <- read_csv(filename)
if (type == "Electric") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Elec- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALKWH*3.41214,
AVERAGEKBTU = AVERAGEKWH*3.41214
) %>%
select(
-c(COMBINED, TOTALKWH, AVERAGEKWH)
)
}
if (type == "Gas") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Gas- Residential",
"Gas- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALTHM*99.9761,
AVERAGEKBTU = AVERAGETHM*99.9761
) %>%
select(
-c(COMBINED, TOTALTHM, AVERAGETHM)
)
}
if (year == 2017) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH,
) %>%
select(
-c(MONTH)
)
}
if (year == 2018) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 12,
) %>%
select(
-c(MONTH)
)
}
if (year == 2019) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 24,
) %>%
select(
-c(MONTH)
)
}
if (year == 2020) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 36,
) %>%
select(
-c(MONTH)
)
}
if (year == 2021) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 48,
) %>%
select(
-c(MONTH)
)
}
pge_20 <- rbind(pge_20,temp_mutate_norm_month)
# Note rbind requires field names to be consistent for every new thing that you add.
saveRDS(pge_20, "pge_20.rds")
}
}
}
}
pge_final <-
pge_20 %>%
select(
-c(AVERAGEKBTU)
) %>%
group_by(MONTH, YEAR, CUSTOMERCLASS) %>%
summarize(
TOTALKBTU =
sum(
TOTALKBTU,
na.rm = T
),
TOTALCUSTOMERS =
sum(
TOTALCUSTOMERS,
na.rm = T
)
) %>%
mutate(
AVERAGEKBTU = TOTALKBTU/TOTALCUSTOMERS
)
pge_final <-
pge_20 %>%
select(
-c(AVERAGEKBTU)
) %>%
group_by(MONTH_NORM, YEAR, CUSTOMERCLASS) %>%
summarize(
TOTALKBTU =
sum(
TOTALKBTU,
na.rm = T
),
TOTALCUSTOMERS =
sum(
TOTALCUSTOMERS,
na.rm = T
)
) %>%
mutate(
AVERAGEKBTU = TOTALKBTU/TOTALCUSTOMERS
)
pge_final_residential <-
pge_final %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
pge_final_commercial <-
pge_final %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Commercial",
"Gas- Commercial"
)
)
library(tidyverse)
library(plotly)
pge_chart <-
pge_final_residential %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Residential Monthly Electricity and Gas Usage",
fill = "Electricity Type"
)
pge_chart
library(tidyverse)
library(plotly)
pge_chart_residential <-
pge_final_residential %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Residential Monthly Electricity and Gas Usage",
fill = "Electricity Type"
)
library(tidyverse)
library(plotly)
pge_chart_residential <-
pge_final_residential %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Residential Monthly Electricity and Gas Usage",
fill = "Utility Type"
)
pge_chart_residential
library(tidyverse)
library(plotly)
pge_chart_commercial <-
pge_final_commercial %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Commercial Monthly Electricity and Gas Usage",
fill = "Utility Type"
)
pge_chart_commercial
pge_chart_commercial
years <- 2019:2020
quarters <- 1:4
types <- c("Electric", "Gas")
pge_19_20 <- NULL
for (type in types) {
for (year in years) {
for(quarter in quarters) {
if ((year != 2021) | (quarter != 3 & quarter != 4)) {
filename <-
paste0(
"pge/PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
temp <- read_csv(filename)
if (type == "Electric") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Elec- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALKWH*3.41214,
AVERAGEKBTU = AVERAGEKWH*3.41214
) %>%
select(
-c(COMBINED, TOTALKWH, AVERAGEKWH)
)
}
if (type == "Gas") {
temp_mutate <-
temp %>%
filter(
CUSTOMERCLASS %in%
c(
"Gas- Residential",
"Gas- Commercial"
)
) %>%
mutate(
TOTALKBTU = TOTALTHM*99.9761,
AVERAGEKBTU = AVERAGETHM*99.9761
) %>%
select(
-c(COMBINED, TOTALTHM, AVERAGETHM)
)
}
if (year == 2019) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH,
) %>%
select(
-c(MONTH)
)
}
if (year == 2020) {
temp_mutate_norm_month <-
temp_mutate %>%
mutate(
MONTH_NORM = MONTH + 12,
) %>%
select(
-c(MONTH)
)
}
pge_19_20 <- rbind(pge_19_20,temp_mutate_norm_month)
# Note rbind requires field names to be consistent for every new thing that you add.
saveRDS(pge_19_20, "pge_19_20.rds")
}
}
}
}
pge_final_19_20 <-
pge_19_20 %>%
select(
-c(AVERAGEKBTU)
) %>%
group_by(MONTH_NORM, YEAR, CUSTOMERCLASS) %>%
summarize(
TOTALKBTU =
sum(
TOTALKBTU,
na.rm = T
),
TOTALCUSTOMERS =
sum(
TOTALCUSTOMERS,
na.rm = T
)
) %>%
mutate(
AVERAGEKBTU = TOTALKBTU/TOTALCUSTOMERS
)
pge_final_19_20_residential <-
pge_final_19_20 %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
pge_final_19_20_commercial <-
pge_final_19_20 %>%
filter(
CUSTOMERCLASS %in%
c(
"Elec- Commercial",
"Gas- Commercial"
)
)
library(tidyverse)
library(plotly)
pge_chart_19_20_residential <-
pge_final_19_20_residential %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Residential Monthly Electricity and Gas Usage 2019-2020",
fill = "Utility Type"
)
pge_chart_19_20_residential
library(tidyverse)
library(plotly)
pge_chart_19_20_commercial <-
pge_final_19_20_commercial %>%
ggplot() +
geom_bar(
aes(
x = MONTH_NORM %>% factor(),
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kBTUs",
title = "PG&E Territory Commercial Monthly Electricity and Gas Usage 2019-2020",
fill = "Utility Type"
)
pge_chart_19_20_commercial
pge_chart_19_20_commercial
View(pge_final_19_20)
